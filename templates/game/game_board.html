{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>üèÅ Sudoku Race: {{ game.code }}</h1>

<div class="game-header">
  <div class="game-info">
    <div class="players">
      <div class="player {% if is_player1 %}current-player{% endif %}">
        <h3>{{ game.player1.username }}</h3>
        <div class="player-timer" id="player1-timer">00:00</div>
        <div class="player-status" id="player1-status">{% if is_player1 %}You{% else %}Opponent{% endif %}</div>
      </div>
      
      <div class="vs">VS</div>
      
      <div class="player {% if is_player2 %}current-player{% endif %}">
        {% if game.player2 %}
          <h3>{{ game.player2.username }}</h3>
          <div class="player-timer" id="player2-timer">00:00</div>
          <div class="player-status" id="player2-status">{% if is_player2 %}You{% else %}Opponent{% endif %}</div>
        {% else %}
          <h3>Waiting...</h3>
          <div class="player-timer">--:--</div>
          <div class="player-status">Joining...</div>
        {% endif %}
      </div>
    </div>
    
    <div class="game-meta">
      <p><strong>Difficulty:</strong> <span class="difficulty-{{ game.difficulty }}">{{ game.get_difficulty_display }}</span></p>
      <p><strong>Status:</strong> <span id="game-status">{{ game.get_status_display }}</span></p>
      <p><strong>Room Code:</strong> <code>{{ game.code }}</code></p>
    </div>
  </div>
</div>

<div id="game-container">
  {% if board %}
    <table class="sudoku-grid">
      <tbody>
        {% for row in board %}
          <tr>
            {% for cell in row %}
              <td class="sudoku-cell" data-row="{{ forloop.parentloop.counter0 }}" data-col="{{ forloop.counter0 }}">
                {% if cell != 0 %}
                  <input type="number" min="1" max="9" class="cell-input prefilled" value="{{ cell }}" disabled>
                {% else %}
                  <input type="number" min="1" max="9" class="cell-input">
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="error">Unable to load board. Refreshing...</p>
  {% endif %}
</div>

<div id="messages"></div>

<div class="game-controls">
  <div id="game-messages"></div>
  <div class="race-controls">
    <button id="ready-btn" class="btn btn-primary" style="display: none;">I'm Ready!</button>
    <button id="start-race-btn" class="btn btn-success" style="display: none;">Start Race!</button>
  </div>
</div>

<div id="game-data" 
  data-game-code="{{ game.code }}"
  data-player-id="{{ user.id }}"
  data-player1-id="{{ game.player1.id }}"
  data-player2-id="{{ game.player2.id|default:'' }}"
  data-difficulty="{{ game.difficulty }}"
  data-is-player1="{% if is_player1 %}true{% else %}false{% endif %}"
  data-is-player2="{% if is_player2 %}true{% else %}false{% endif %}"
  data-game-status="{{ game.status }}"
  style="display: none;"></div>

<script src="{% static 'game/game_board.js' %}"></script>
{% endblock %}
